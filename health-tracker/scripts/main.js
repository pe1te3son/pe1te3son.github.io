"use strict";var app=app||{};!function(){app.FoodSingle=Backbone.Model.extend({defaults:{brandName:"",name:"",calories:0}})}();var app=app||{};!function(){app.DailyCalories=Backbone.Model.extend({defaults:{calories:0,day:0}})}();var app=app||{};!function(){app.SearchListCol=Backbone.Collection.extend({model:app.FoodSingle,setInputVal:function(e){this.inputVal=e},url:function e(){var e="https://api.nutritionix.com/v1_1/search/",a=this.inputVal,t="?results=0%3A11&cal_min=0&cal_max=50000",n="&fields=item_name%2Cbrand_name%2cnf_calories",r="&appId=9fbd69c5",i="&appKey=4654813d6d125572f15f30d534dceb88";return e+a+t+n+r+i},parse:function(e){for(var a=[],t=0;t<e.hits.length;t++){var n=new app.FoodSingle({brandName:e.hits[t].fields.brand_name,name:e.hits[t].fields.item_name,calories:e.hits[t].fields.nf_calories});a.push(n)}return a}})}();var app=app||{};!function(){app.FirebaseFoodCol=Backbone.Firebase.Collection.extend({model:app.FoodSingle,url:function e(){var e=app.firebaseUrl,a=app.userId,t=app.currentDate.year,n=app.currentDate.month,r=app.currentDate.day;return e+a+"/"+t+"/"+n+"/"+r+"/food"},countAll:function(){var e=0;return this.forEach(function(a){e+=a.toJSON().calories}),e}})}();var app=app||{};!function(){app.CalSumCol=Backbone.Firebase.Collection.extend({model:app.DailyCalories,url:function e(){var e=app.firebaseUrl,a=app.userId,t=app.currentDate.year,n=app.currentDate.month,r=app.currentDate.day;return e+a+"/"+t+"/"+n+"/"+r}})}();var app=app||{};!function(){app.GraphCol=Backbone.Firebase.Collection.extend({url:function e(){var e=app.firebaseUrl,a=app.userId,t=app.currentDate.year,n=app.currentDate.month;return e+a+"/"+t+"/"+n}})}();var app=app||{};!function(e){app.SearchSingleView=Backbone.View.extend({tagName:"li",className:"col-xs-12",singleFoodTemplate:_.template(e("#search-single-template").html()),events:{click:"foodClicked"},render:function(){return this.$el.html(this.singleFoodTemplate(this.model.attributes)),this},foodClicked:function(){app.savedFoodCollection.create(this.model.toJSON())}})}(jQuery);var app=app||{};!function(e){app.SavedSingleView=Backbone.View.extend({tagName:"li",className:"col-xs-12",singleFoodTemplate:_.template(e("#saved-single-template").html()),events:{click:"foodClicked"},initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.singleFoodTemplate(this.model.attributes)),this},foodClicked:function(){this.model.destroy(),app.savedFoodView.displayCaloriesSum()}})}(jQuery);var app=app||{};!function(e){app.SearchView=Backbone.View.extend({el:"#search-view",events:{"input #search-input":"searchData","click #datepicker-btn":"showCalendar","click #search-list-btn":"showSearchList","click #search-menu-toggle-btn":"toggleSearchResults"},initialize:function(){this.collection=new app.SearchListCol,this.$searchControls=e(".search-controls"),this.$searchField=e("#search-input"),this.$list=e("#search-result-list"),this.$listContainer=e(".search-result-cont"),this.$datepicker=e("#datepicker"),this.listenTo(this.collection,"sync",this.render),this.$datepickerBtn=e("#datepicker-btn"),this.$searchListBtn=e("#search-list-btn"),this.$searchMenuToggleBtn=e("#search-menu-toggle-btn").children().first()},searchData:function(){var e=this;this.showSearchList(),this.$list.html(""),app.helpers.spinner(this.$list,"insert"),this.$searchField.keydown(function(e){e.which===ENTER_KEY&&e.preventDefault()}),this.collection.setInputVal(this.$searchField.val()),this.collection.fetch({error:function(){console.log("NO CONECTION"),e.$list.html(""),e.$list.append("<h2>Oops, something went wrong!</h2><p>Please try later or reload the page.</p>")}})},render:function(){this.$list.html(""),this.collection.each(function(e){var a=new app.SearchSingleView({model:e});this.$list.append(a.render().el)}.bind(this)),this.$searchMenuToggleBtn.hasClass("fa-angle-double-up")||(this.$searchMenuToggleBtn.addClass("fa-angle-double-up").removeClass("fa-angle-double-down"),this.$list.slideDown("fast"))},showCalendar:function(e){this.$searchListBtn.removeClass("selected-panel"),this.$datepickerBtn.addClass("selected-panel"),this.$datepicker.show(),this.$listContainer.hide()},showSearchList:function(){this.$datepickerBtn.removeClass("selected-panel"),this.$searchListBtn.addClass("selected-panel"),this.$datepicker.hide(),this.$listContainer.show()},toggleSearchResults:function(e){this.$searchMenuToggleBtn.toggleClass("fa-angle-double-up fa-angle-double-down"),this.$list.slideToggle("fast")}})}(jQuery);var app=app||{};!function(e){app.SavedFoodView=Backbone.View.extend({el:"#saved-food-view",initialize:function(){this.$list=e("#saved-food-list"),this.$caloriesContainer=e("#all-calories"),this.$dateHolder=e("#date-today"),this.listenTo(app.savedFoodCollection,"add",this.render),this.displayCaloriesSum(),this.displayCurentDate()},render:function(){return this.$list.html(""),app.savedFoodCollection.each(this.addOne,this),this.displayCaloriesSum(),this},addOne:function(e){var a=new app.SavedSingleView({model:e});this.$list.prepend(a.render().el)},displayCaloriesSum:function(){var e=app.savedFoodCollection.countAll(),a=parseFloat(e).toFixed(1);this.$caloriesContainer.html(""),this.$caloriesContainer.html(a),e>0&&this.saveDailyCalories(a)},saveDailyCalories:function(e){this.calSumCol=new app.CalSumCol,this.calSumCol.create({id:"caloriesToday",calories:e,day:app.currentDate.day})},displayCurentDate:function(){this.$dateHolder.html("").append('<span class="day-of-week">'+app.currentDate.dayOfWeek+'</span><span class="date">'+app.currentDate.month+" "+app.currentDate.day+" "+app.currentDate.year+"</span>")}})}(jQuery);var app=app||{};!function(e){app.AppView=Backbone.View.extend({el:"#app",loginFormTemplate:_.template(e("#login-form-template").html()),loginControlsTemplate:_.template(e("#login-controls-template").html()),events:{"click #login":"loginForm","click #register":"registerForm","click #log-out":"logOut"},initialize:function(){app.currentDate={graphPrefix:moment().format("YYYY-M-"),year:moment().format("YYYY"),month:moment().format("MMMM"),day:moment().format("D"),dayOfWeek:moment().format("dddd"),daysThisMonth:moment().daysInMonth()},app.firebaseUsers=new Firebase(app.firebaseUrl),this.healthTrackerCreateUser(),app.searchView=new app.SearchView,app.picker=new Pikaday({field:document.getElementById("datepicker-input"),firstDay:1,minDate:new Date(2e3,0,1),maxDate:new Date(moment().year(),moment().month(),moment().format("D")),yearRange:5,bound:!1,onSelect:function(){app.currentDate.graphPrefix=this.getMoment().format("YYYY-M-"),app.currentDate.year=this.getMoment().format("YYYY"),app.currentDate.month=this.getMoment().format("MMMM"),app.currentDate.day=this.getMoment().format("D"),app.currentDate.dayOfWeek=this.getMoment().format("dddd"),app.currentDate.daysThisMonth=this.getMoment().daysInMonth(),app.savedFoodCollection=new app.FirebaseFoodCol,app.savedFoodView.initialize(),app.savedFoodView.render()},onDraw:function(){var e=app.currentDate.month;app.currentDate.month=moment().month(this.calendars[0].month).format("MMMM"),e!=app.currentDate.month&&app.showGraph()},container:document.getElementById("datepicker-container")}),e(window).on("resize",function(){app.helpers.buildGraph(app.dataForGraph)})},switchForms:function(e,a){"none"===a?"undefined"!=typeof e&&(e.slideUp(100),e.attr("data","")):e.attr("data")===a?(e.slideUp(100),e.attr("data","")):e.attr("data")!==a&&""!==e.attr("data")?(e.slideUp(100).slideDown("fast"),e.attr("data",a)):(e.attr("data",a),e.slideDown("fast"))},loginForm:function(){var a=this;a.$registerBtn.removeClass("form-selected"),a.$loginBtn.toggleClass("form-selected"),a.$formContainer.html("").append(a.loginFormTemplate({login:!0,id:"login"})),a.switchForms(a.$formContainer,"login"),e("#login-form").on("submit",function(t){t.preventDefault(),app.helpers.spinner(e("#spinner-cont"),"insert");var n=e("#error-msg-cont"),r=e("#inputEmail").val(),i=e("#inputPassword").val(),s="";app.firebaseUsers.authWithPassword({email:r,password:i},function(t,r){if(t){switch(t.code){case"INVALID_EMAIL":s+="* The specified user account email is invalid.";break;case"INVALID_PASSWORD":s+="* The specified user account or password is incorrect.";break;case"INVALID_USER":s+="* The specified user account does not exist.";break;default:s="Error logging user in: "+t}n.html("").append(s)}else a.$formContainer.html("").append('<p class="text-center">You are now Logged In. Welcome!</p>'),a.healthTrackerCreateUser(),app.savedFoodView.initialize(),app.savedFoodView.render(),app.showGraph(),setTimeout(function(){a.switchForms(a.$formContainer,"none")},3e3);app.helpers.spinner(e("#spinner-cont"),"remove")})})},registerForm:function(){this.$loginBtn.removeClass("form-selected"),this.$registerBtn.hasClass("form-selected")?this.$registerBtn.removeClass("form-selected"):this.$registerBtn.addClass("form-selected"),this.$formContainer.html("").append(this.loginFormTemplate({login:!1,id:"register"})),e("#register-form").on("submit",function(a){a.preventDefault(),app.helpers.spinner(e("#spinner-cont"),"insert");var t=e("#inputEmail").val(),n=e("#inputPassword").val(),r=e("#inputPasswordConfirm").val(),i=e("#error-msg-cont"),s=app.helpers.passwordsMatch(n,r),o="";s===!0&&n.length>=6?app.firebaseUsers.createUser({email:t,password:n},function(a,t){if(a)switch(a.code){case"EMAIL_TAKEN":o+="* The new user account cannot be created because the email is already in use.";break;case"INVALID_EMAIL":o+="* The specified email is not a valid email.";break;default:o="Error creating user:"+a}else{var n='<p class="text-center">Your account has been successfully created. Please <strong>Log In</strong> !</p>';e("#form-cont").html("").append(n)}e("#inputPassword").val(""),e("#inputPasswordConfirm").val(""),i.html("").append(o),app.helpers.spinner(e("#spinner-cont"),"remove")}):(o=s===!0?"* Password must be at least 6 characters!":"* Passwords do not match!",e("#inputPassword").val(""),e("#inputPasswordConfirm").val(""),i.html("").append(o),app.helpers.spinner(e("#spinner-cont"),"remove"))}),this.switchForms(this.$formContainer,"register")},logOut:function(){app.firebaseUsers.unauth(),this.healthTrackerCreateUser(),app.savedFoodView.initialize(),app.savedFoodView.render(),app.showGraph()},healthTrackerCreateUser:function(){this.authData=app.firebaseUsers.getAuth();var a=e("#login-controls");null!==this.authData?(app.userId=this.authData.uid,a.html("").append(this.loginControlsTemplate({loggedIn:!0})),this.$logOutBtn=e("#log-out"),app.savedFoodCollection=new app.FirebaseFoodCol,app.savedFoodView=new app.SavedFoodView):(app.userId="default",a.html("").append(this.loginControlsTemplate({loggedIn:!1})),this.$formContainer=e("#form-cont"),this.$registerBtn=e("#register"),this.$loginBtn=e("#login"),app.savedFoodCollection=new app.FirebaseFoodCol,app.savedFoodView=new app.SavedFoodView),app.showGraph()}})}(jQuery);var app=app||{},ENTER_KEY=13;$(function(){app.firebaseUrl="https://health-tracker-janak.firebaseio.com/",app.helpers={buildGraph:function(e){var a=this;$("#chartdiv").html(""),$.jqplot("chartdiv",[e],{title:{text:"Calories "+app.currentDate.month+" "+app.currentDate.year,textColor:"#000",fontFamily:'"Ubuntu", "sans-serif"'},animate:!0,animateReplot:!0,seriesDefaults:{rendererOptions:{animation:{speed:4e3}},markerRenderer:$.jqplot.MarkerRenderer,markerOptions:{show:!1}},axesDefaults:{tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{textColor:"#000"}},series:[{color:"#A9ADD3"}],axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%b %#d"},min:a.setFirstDay()},yaxis:{min:0}},cursor:{show:!0,zoom:!0,looseZoom:!1,showHorizontalLine:!0},grid:{background:"#ffffff"}}),$.jqplot.config.enablePlugins=!0},setFirstDay:function(){var e=app.currentDate.graphPrefix+"1";return e},passwordsMatch:function(e,a){return e===a},spinner:function(e,a){var t=e,n=a;"insert"===n?t.append('<div class="spinner-wrapper"><i class="fa fa-spinner fa-spin fa-lg loading-spinner"></i><span class="sr-only">Loading...</span></div>'):"remove"===n&&t.html("")}},app.showGraph=function(){app.dataForGraph=[],app.graphCol=new app.GraphCol,app.graphCol.fetch({success:function(){for(var e=1;e<app.currentDate.daysThisMonth+1;e++)if(app.graphCol.get(e)){var a=parseFloat(app.graphCol.get(e).toJSON().caloriesToday.calories),t=app.graphCol.get(e).toJSON().caloriesToday.day,n=app.currentDate.graphPrefix+t;app.dataForGraph.push([n,a])}else app.dataForGraph.push([app.currentDate.graphPrefix+e,0]);app.helpers.buildGraph(app.dataForGraph),$("#chartdiv").addClass("animated fadeInUp")},error:function(){console.log("fetching failed")}})},new app.AppView});