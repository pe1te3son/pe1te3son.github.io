"use strict";$(document).ready(function(){var e,o={auth:{client_id:"COIOBSSXMC4DBNB22N0WZ1WC3W0PXOFMC1NJW5PN1BL0FINU",client_secret:"QKFUWS0PWNBAKMHNDGTPYUT0CAQIM2TJGJIHWSMH4Q5YORRH"},locations:[{name:"British Museum",lat:51.519459,lng:-.126931,id:"4ac518d2f964a5203da720e3"},{name:"Madame Tussauds",lat:51.5229,lng:-.1548,id:"4ac518cef964a520fca520e3"},{name:"Buckingham Palace",lat:51.501476,lng:-.140634,id:"4abe4502f964a520558c20e3"},{name:"Stratford picture house",lat:51.54303859900249,lng:.001206887404320114,id:"4b310ca6f964a52002ff24e3"},{name:"The Cow",lat:51.519200629510514,lng:-.1954983152188697,id:"4ac518bdf964a520dfa220e3"},{name:"London Zoo",lat:51.535645144168825,lng:-.15573978424072266,id:"4ac51183f964a52048a020e3"},{name:"Royal Botanic Gardens",lat:51.477747968798816,lng:-.296630859375,id:"4ac518cef964a52002a620e3"},{name:"The Courtauld Gallery",lat:51.51157280958188,lng:-.1176735793118728,id:"4ac518d2f964a5203fa720e3"},{name:"Royal Observatory",lat:51.4771332098067,lng:-.0007510185241699219,id:"4ac518cef964a5203aa620e3"},{name:"Hyde park",lat:51.507460346127864,lng:-.16213417053222656,id:"4ac518d2f964a52026a720e3"}]},a=function(e){var o=this;o.lat=ko.observable(e.lat),o.lng=ko.observable(e.lng),o.id=ko.observable(e.id),o.position=ko.computed(function(){return{lat:o.lat(),lng:o.lng()}}),o.name=ko.observable(e.name),o.photoLink=ko.observable(),o.address=ko.observable(),o.ratingColor=ko.observable(),o.rating=ko.observable(),o.desc=ko.observable(),o.facebook=ko.observable(),o.twitter=ko.observable(),o.phone=ko.observable(),o.phoneTel=ko.observable(),o.statusL=ko.observable(),o.url=ko.observable(),o.formatedUrl=ko.observable()},n=function(){var n=this;n.places=ko.observableArray(),n.search=ko.observable(""),n.displayInfo=ko.observable(""),n.infoWin=ko.observable(new google.maps.InfoWindow),n.currentPlace=ko.observable(),n.currentPlaceNotEmpty=ko.observable(!1),o.locations.forEach(function(e){n.places().push(new a(e))}),n.searchInput=ko.computed(function(){var e=this.search().toLowerCase();return e?ko.utils.arrayFilter(n.places(),function(o){var a=-1!==o.name().toLowerCase().indexOf(e);return a?o.marker.setVisible(!0):o.marker.setVisible(!1),a}):(n.places()[0].marker&&n.places().forEach(function(e){e.marker.setVisible(!0)}),n.places())},n),n.locClick=function(o){null!==o.marker.getAnimation()?o.marker.setAnimation(null):o.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.marker.setAnimation(null)},1500),e.setCenter(o.marker.getPosition()),n.getInfo(o.marker),n.openInfoWindow()};var t=$("#more-info"),s=$("#close-info");n.closeOpenMoreInfo=function(){t.hasClass("slide-out")&&s.hasClass("closeOpen")?(t.removeClass("slide-out"),s.removeClass("closeOpen")):(t.addClass("slide-out"),s.addClass("closeOpen"))},n.openInfoWindow=function(){t.hasClass("slide-out")||s.hasClass("closeOpen")||(t.addClass("slide-out"),s.addClass("closeOpen"))},n.closeMoreInfo=function(){t.hasClass("slide-out")&&s.hasClass("closeOpen")&&(t.removeClass("slide-out"),s.removeClass("closeOpen"))},n.getInfo=function(a){var t=a.parent,s=o.auth.client_id,r=o.auth.client_secret,i="https://api.foursquare.com/v2/venues/"+t.id()+"?client_id="+s+"&client_secret="+r+"&v=20160501";$.ajax({dataType:"json",url:i,cache:!0,success:function(o){n.processInfo(o,t),n.infoWin().setContent('<h4 class="marker-info">'+t.name()+"</h4>"),n.infoWin().open(e,t.marker),n.openInfoWindow()},error:function(){var o='<h2 class="error-msg">Ooops, something went wrong!</h2><p>Please reload a page or check your internet conection</p>';n.infoWin().setContent(o),n.infoWin().open(e,t.marker)}})},n.processInfo=function(e,o){var a=e.response.venue;if(a.bestPhoto&&o.photoLink(a.bestPhoto.prefix+"400x300"+a.bestPhoto.suffix),a.location.formattedAddress&&o.address(a.location.formattedAddress),a.rating&&a.ratingColor){var t="background: #"+a.ratingColor;o.ratingColor(t),o.rating(a.rating)}if(a.description&&o.desc(e.response.venue.description),a.contact.facebook?(o.facebook("http://facebook.com/"+a.contact.facebook),o.facebookExists=ko.observable(!0)):o.facebookExists=ko.observable(!1),a.contact.twitter?(o.twitter(a.contact.twitter),o.twitterExists=ko.observable(!0)):o.twitterExists=ko.observable(!1),a.contact.phone?(o.phone(a.contact.phone),o.phoneTel("tel:"+a.contact.phone),o.phoneExists=ko.observable(!0)):o.phoneExists=ko.observable(!1),a.url){var s=a.url,r=s.replace("http://","");o.formatedUrl(r),o.url(a.url)}n.currentPlace(o),n.currentPlaceNotEmpty(!0)}};ko.bindingHandlers.googlemap={init:function(o,a,n,t,s){var r=a(),i={zoom:11,center:new google.maps.LatLng(r.centerLat,r.centerLon),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER}};e=new google.maps.Map(o,i),window.mapBounds=new google.maps.LatLngBounds},update:function(o,a,n,t,s){var r=a();r.places().forEach(function(o){var a=new google.maps.LatLng(o.position());o.marker=new google.maps.Marker({position:a,map:e,animation:google.maps.Animation.DROP,parent:o}),o.marker.addListener("click",function(){e.setCenter(this.getPosition()),t.getInfo(this)});var n=window.mapBounds;n.extend(new google.maps.LatLng(o.position())),e.fitBounds(n),e.setCenter(n.getCenter())}),window.addEventListener("resize",function(o){e.fitBounds(mapBounds),t.closeMoreInfo(),t.infoWin().close()})}};var t=function(){var e=document.getElementById("off-btn"),o=document.getElementById("off-body"),a=document.getElementById("off-nav");e.addEventListener("click",function(e){a.classList.toggle("off-shift"),o.classList.toggle("off-shift")},!1)};t(),ko.applyBindings(new n)});